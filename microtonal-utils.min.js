(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.microtonal_utils = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const pf=require("primes-and-factors"),Fraction=require("fraction.js"),Interval=require("./interval.js"),{edoApprox:edoApprox}=require("./edo.js");function signPerms(t){const e=Object.keys(t);let o=[];for(let t=0;t<1<<e.length;t++)o.push(e.map((e,o)=>0==(t&1<<o)?1:-1));return o}function applySignPerm(t,e){let[o,n]=[0,{}];for(const[r,s]of Object.entries(e))n[r]=s.mul(t[o]),o++;return Interval(n)}function bestRationalApproxs(t,e,o){o||("object"==typeof e&&null!=e?(o=e,e=void 0):o={});const n=Interval(t,e);console.time("rationalApprox");let{cutoff:r,primeLimit:s,oddLimit:l,startIteration:p,numIterations:i,useExactDiffs:a}=o,[c,f]=[!1,!1],u=100;s&&(u=Math.ceil(2e3/s+(s+1)/2),s<=2&&(l=1));const d=l*Math.abs(l-2);l&&(u=Math.min(u,Math.ceil((d+1)/2))),null==r&&(r=Interval(2).pow(1,12).sqrt()),null==s&&l&&(s=l),null==p&&(p=0),null==i&&(i=1);let m=(p+i)*u;l&&m>=(d+1)/2&&(m=(d+1)/2,c=!0);const x=n.red();n.div(x);let[v,b]=[Interval(2),[]];for(let t=p*u;!f&&t<m;t++){const e=Interval(2*t+1);if(s&&Object.keys(e).some(t=>t>s))continue;const o=signPerms(e).map(t=>applySignPerm(t,e)).map(function(t){const e=t.div(n).reb();return[n.mul(e),e]}).sort((t,e)=>t[1].compare(e[1]));for(const[t,e]of o){const o=t.toFrac();if(l&&(o.n%2!=0&&o.n>l||o.d%2!=0&&o.d>l))continue;const n=e.compare(1)<0?e.recip():e;n.compare(r)<0&&n.compare(v)<=0&&(b.push({ratio:o,diff:a?e:e.toCents()}),(v=n).equals(1)&&(f=!0))}}return console.timeEnd("rationalApprox"),(c||f)&&console.log("rationalApprox: exhausted"),[c||f,b]}function bestEDOApproxsByEDO(t,e,o){o||("object"==typeof e&&null!=e?(o=e,e=void 0):o={});const n=Interval(t,e);null==o&&(o={});let{cutoff:r,startEDO:s,endEDO:l,useExactDiffs:p}=o;null==r&&(r=Interval(2).pow(1,12).sqrt()),null==s&&(s=5),null==l&&(l=60);let i=!1,[a,c]=[Interval(2),[]];for(let t=s;!i&&t<=l;t++){const e=edoApprox(t,n),o=n.div(Interval(2).pow(e,t)),s=o.compare(1)<0?o.recip():o;s.compare(r)<0&&s.compare(a)<=0&&(0==s.compare(a)?c[c.length-1].steps.push([e,t]):(c.push({steps:[[e,t]],diff:p?o:o.toCents()}),(a=s).equals(1)&&(i=!0)))}return c}function bestEDOApproxsByDiff(t,e,o){o||("object"==typeof e&&null!=e?(o=e,e=void 0):o={});const n=Interval(t,e);null==o&&(o={});let{startEDO:r,endEDO:s,useExactDiffs:l}=o;null==r&&(r=5),null==s&&(s=60);let p=[];for(let t=r;t<=s;t++){const e=edoApprox(t,n),o=n.div(Interval(2).pow(e,t)),r=o.compare(1)<0?o.recip():o,s={steps:[[e,t]],diff:o,abs_diff:r};let l=!1;for(let n=0;!l&&n<p.length;n++)o.equals(p[n].diff)?(p[n].steps.push([e,t]),l=!0):r.compare(p[n].abs_diff)<0&&(p.splice(n,0,s),l=!0);l||p.push(s)}return p.map(t=>({steps:t.steps,diff:l?t.diff:t.diff.toCents()}))}module.exports.bestRationalApproxs=bestRationalApproxs,module.exports.bestEDOApproxsByEDO=bestEDOApproxsByEDO,module.exports.bestEDOApproxsByDiff=bestEDOApproxsByDiff;

},{"./edo.js":2,"./interval.js":6,"fraction.js":12,"primes-and-factors":16}],2:[function(require,module,exports){
const{gcd:gcd,egcd:egcd}=require("mathutils"),Fraction=require("fraction.js"),Interval=require("./interval.js"),py=require("./pythagorean.js");function mod(e,t){return(e%t+t)%t}function edoApprox(e,t,o){return Math.round(e*Interval(t,o).toCents()/1200)}function edoPy(e,t,o){const n=Interval(t,o),r=Fraction(py.pyGenerator(n)*edoApprox(e,3,2),4),s=py.pyOctaves(n);if(1!=r.d)throw e+"-EDO has no "+py.pySymb(n,{verbosity:1})+" interval";return r.s*r.n+s*e}function edoPyInv(e,t){const o=edoApprox(e,3,2),[n,r,s]=egcd(o,4*e);if(4*t%n==0){const[a,p]=[r*(4*t/n),s*(4*t/n)],u=Math.floor((4*e/n-1)/2),d=mod(a+u,4*e/n)-u,l=p-o*((d-a)/(4*e));return Interval(3,2).pow(d,4).mul(Interval(2).pow(l))}}function edoPyComma(e){const t=edoApprox(e,3,2),o=gcd(t,4*e);return Interval(3,2).pow(-4*e/o,4).mul(Interval(2).pow(t/o))}function edoHasNeutrals(e){return edoApprox(e,3,2)%2==0}function edoHasSemiNeutrals(e){return edoApprox(e,3,2)%4==0}function fillGens(e,t,o,n){let r=[];for(let t=0;t<e;t++)r.push(Array(0));o<=0&&0<=n&&r[0].push(0);for(let s=1;s<=Math.max(Math.abs(o),Math.abs(n));s++)o<=s&&s<=n&&r[mod(s*t,e)].push(s),o<=-s&&-s<=n&&r[mod(-s*t,e)].push(-s);return r}function addUpdns(e,t){let o=t.map(e=>Array(0)),[n,r]=[0,e];for(let s=0;s<e;s++){0==t[s].length?o[s].push(...t[n].map(e=>[s-n,e])):(o[s].push(...t[s].map(e=>[0,e])),n=s);const a=e-1-s;0==t[a].length?o[a].push(...t[mod(r,e)].map(e=>[a-r,e])):r=a}for(let t=0;t<e;t++){let[n,r]=[e,!1];for(const[e,s]of o[t])n=Math.min(n,Math.abs(e)),r=r||Number.isInteger(s);o[t]=o[t].filter(e=>Math.abs(e[0])<=n&&(!r||Number.isInteger(e[1]))).sort((e,t)=>e[0]==t[0]?Math.abs(e[1])-Math.abs(t[1]):t[0]-e[0])}return o}function cvtGensToPy(e,t){for(let o=0;o<e;o++)for(let e=0;e<t[o].length;e++){let n=Interval(0==t[o][e][1]&&t[o][e][0]<0?2:1);t[o][e][1]=Interval(3,2).pow(t[o][e][1]).red().mul(n)}return t}let upsdnsSymbCache_var={};function updnsSymbCache(e){if(upsdnsSymbCache_var[e])return upsdnsSymbCache_var[e];const t=edoApprox(e,3,2);let o,[n,r]=[-6,6];if(t/e==4/7&&([n,r]=[-1.5,1.5]),t/e==.6&&([n,r]=[-4,4]),t%2!=0)o=fillGens(e,t,n,r);else{o=fillGens(e,t/2,2*n,2*r);for(let t=0;t<e;t++)o[t]=o[t].filter(e=>e%2==0||Math.abs(e)<=6).map(e=>e/2)}return o=cvtGensToPy(e,addUpdns(e,o)),upsdnsSymbCache_var[e]=o,o}function updnsSymb(e,t){const o=mod(t,e),n=Interval(2).pow(t-o,e),r=updnsSymbCache(e)[o];let s=[];for(let e=0;e<r.length;e++){const t=(r[e][0]>0?"^":"v").repeat(Math.abs(r[e][0]))+py.pySymb(r[e][1].mul(n));s.push(t.replace("n","~").replace("sA","~").replace("sd","~"))}return s}let upsdnsNoteCache_var={};function updnsNoteCache(e){if(upsdnsNoteCache_var[e])return upsdnsNoteCache_var[e];const t=edoApprox(e,3,2);let[o,n]=[-9,7];t/e==4/7&&([o,n]=[-4,2]),t/e>4/7&&t/e<7/12&&([o,n]=[-11,9]);const r=cvtGensToPy(e,addUpdns(e,fillGens(e,t,o,n)));return upsdnsNoteCache_var[e]=r,r}function updnsNote(e,t,o){const n=mod(t,e),r=Interval(2).pow(t-n,e),s=updnsNoteCache(e)[n];let a=[];for(let e=0;e<s.length;e++){const t=(s[e][0]>0?"^":"v").repeat(Math.abs(s[e][0]))+py.pyNote(s[e][1].mul(r),o);a.push(t)}return a}module.exports.edoApprox=edoApprox,module.exports.edoPy=edoPy,module.exports.edoPyInv=edoPyInv,module.exports.edoPyComma=edoPyComma,module.exports.edoHasNeutrals=edoHasNeutrals,module.exports.edoHasSemiNeutrals=edoHasSemiNeutrals,module.exports.updnsSymbCache=updnsSymbCache,module.exports.updnsSymb=updnsSymb,module.exports.updnsNoteCache=updnsNoteCache,module.exports.updnsNote=updnsNote;

},{"./interval.js":6,"./pythagorean.js":11,"fraction.js":12,"mathutils":13}],3:[function(require,module,exports){
const pf=require("primes-and-factors"),Fraction=require("fraction.js"),Interval=require("./interval.js"),{pySymb:pySymb,pyGenerator:pyGenerator}=require("./pythagorean.js"),{fjsFifthShift:fjsFifthShift,fjsAccidentals:fjsAccidentals,nfjsParams:nfjsParams}=require("./fjs.js"),{updnsSymbCache:updnsSymbCache}=require("./edo.js"),primeNames={5:["classic","cls."],7:["septimal","sep."],11:["undecimal","und."],13:["tridecimal","trid."],17:["septendecimal","sepd."],19:["undevicesimal","undv."]};function enNames(e,s,t){t||"object"!=typeof s||null==s||(t=s,s=void 0);const r=Interval(e,s),n=(t||{}).abbreviate?1:0,i=n?1:2,a=(t||{}).prefEDO;let p=[];r.equals(Interval(2).sqrt())&&p.push("tritone");const c=fjsAccidentals(e,s,nfjsParams);if(c){let e=pySymb(c.pyi,{verbosity:i});const s=Object.entries(r).filter(e=>e[0]>3);if(0==s.length)r[3]&&(1!=r[3].d||r[3].n>1)?p.push((n?"py. ":"pythagorean ")+e):p.push(e);else if(1==s.length){const[t,i]=s[0];if(primeNames[t]&&1==i.d&&0!=pyGenerator(c.pyi)){const s=fjsFifthShift(t,nfjsParams),a=c.pyi[3]||Fraction(0);if(i.s==s.s*a.s&&a.d==s.d){let l=!1;if(1==s.d&&(l=6==a.n?2==i.n:i.n==2+Math.floor((a.n-6)/7)),2==s.d&&(l=a.n<=11&&1==i.n),l){if(4==Math.abs(pyGenerator(c.pyi))){const s=r.compare(c.pyi)>0?"super":"sub";e=n?e.replace("perfect",s):e.replace("perfect ",s+"-")}p.push(primeNames[t][n]+" "+e.replace("perfect ",""))}}}}}else if(Object.entries(r).length==(null!=r[2])){const e=r[2]||Fraction(0),s=a||e.d,t=s+"-EDO ";let c=[];if(1==e.mul(s).d&&(a||s<=60)){const r=(e.s*e.mul(s).n%s+s)%s;for(const[e,t]of updnsSymbCache(s)[r]){let s="";1==e?s="up":-1==e?s="down":2!=e||n?-2!=e||n?e>=2?s=e+"-up ":e<=-2&&(s=e+"-down "):s="double-down ":s="double-up ";let r=pySymb(t,{verbosity:i});r=n?r.replace("perfect",""):r.replace("perfect ","-"),c.push(s+r)}p.push(t+c.join(" / "))}}return p}module.exports.enNames=enNames;

},{"./edo.js":2,"./fjs.js":4,"./interval.js":6,"./pythagorean.js":11,"fraction.js":12,"primes-and-factors":16}],4:[function(require,module,exports){
const pf=require("primes-and-factors"),Fraction=require("fraction.js"),Interval=require("./interval.js"),py=require("./pythagorean.js"),fjsRoT=Interval(65,63);function*fjsFifthsSeq(){yield 0;for(let t=1;;t++)yield Fraction(t),yield Fraction(-t)}const fjsParams={RoT:fjsRoT,fifthsSeq:fjsFifthsSeq,hasNeutrals:!1},nfjsRoT=py.pyInterval(2,-1);function*nfjsFifthsSeq(){yield 0;for(let t=1;t<=6;t++)yield Fraction(t),yield Fraction(-t);for(let t=1;t<6;t++)yield Fraction(2*t-1,2),yield Fraction(1-2*t,2)}const nfjsParams={RoT:nfjsRoT,fifthsSeq:nfjsFifthsSeq,hasNeutrals:!0};function fjsFifthShift(t,s,e){e||("object"==typeof s&&null!=s?(e=s,s=void 0):e=fjsParams);const o=Interval(t,s),r=e.fifthsSeq();for(const t of r){let s=o.div(Interval(3,2).pow(t)).reb();if(s.compare(e.RoT)<0&&e.RoT.recip().compare(s)<0)return t}}function fjsComma(t,s){if(s||(s=fjsParams),t=parseInt(t),!pf.isPrime(t)||t<=3)throw"input is not a prime interval greater than 3";const e=s.fifthsSeq();for(const o of e){let e=Interval(t).div(Interval(3,2).pow(o)).reb();if(e.compare(s.RoT)<0&&s.RoT.recip().compare(e)<0)return e}}function fjsFactor(t,s,e){e||("object"==typeof s&&null!=s?(e=s,s=void 0):e=fjsParams);const o=Interval(t,s);let r=Interval(1);for(const[t,s]of Object.entries(o))r=r.mul(fjsComma(t,e).pow(s));return r}function fjsAccidentals(t,s,e){e||("object"==typeof s&&null!=s?(e=s,s=void 0):e=fjsParams);const o=Interval(t,s);let r=o,f=[],n=[];for(let[t,s]of Object.entries(o))if(2!=t&&3!=t){for(r=r.div(fjsComma(t,e).pow(s));s>=1;)f.push(t),s=s.sub(1);for(s>0&&2==s.d&&f.push("sqrt("+t+")"),s>0&&s.d>2&&f.push("root"+s.d+"("+t+")");s<=-1;)n.push(t),s=s.add(1);s<0&&2==s.d&&n.push("sqrt("+t+")"),s<0&&s.d>2&&n.push("root"+s.d+"("+t+")")}const i=e.hasNeutrals?2:4;if(py.isPythagorean(r)&&py.pyGenerator(r)%i==0){return{accStr:(0==f.length?"":"^"+f.join(","))+(0==n.length?"":"_"+n.join(",")),pyi:r}}}function fjsSymb(t,s,e){const o=fjsAccidentals(t,s,e);if(o)return py.pySymb(o.pyi)+o.accStr}function fjsNote(t,s,e){const o=fjsAccidentals(t,s,e);if(o)return py.pyNote(o.pyi)+o.accStr}module.exports.fjsRoT=fjsRoT,module.exports.fjsFifthsSeq=fjsFifthsSeq,module.exports.fjsParams=fjsParams,module.exports.nfjsRoT=nfjsRoT,module.exports.nfjsFifthsSeq=nfjsFifthsSeq,module.exports.nfjsParams=nfjsParams,module.exports.fjsFifthShift=fjsFifthShift,module.exports.fjsComma=fjsComma,module.exports.fjsFactor=fjsFactor,module.exports.fjsAccidentals=fjsAccidentals,module.exports.fjsSymb=fjsSymb,module.exports.fjsNote=fjsNote;

},{"./interval.js":6,"./pythagorean.js":11,"fraction.js":12,"primes-and-factors":16}],5:[function(require,module,exports){
module.exports.Fraction=require("fraction.js"),module.exports.Interval=require("./interval.js"),Object.assign(module.exports,require("./pythagorean.js")),Object.assign(module.exports,require("./fjs.js")),Object.assign(module.exports,require("./edo.js")),Object.assign(module.exports,require("./approx.js")),Object.assign(module.exports,require("./english.js")),Object.assign(module.exports,require("./parser.js"));

},{"./approx.js":1,"./edo.js":2,"./english.js":3,"./fjs.js":4,"./interval.js":6,"./parser.js":7,"./pythagorean.js":11,"fraction.js":12}],6:[function(require,module,exports){
const pf=require("primes-and-factors"),Fraction=require("fraction.js"),keys=function(t,n){let e={};for(const[n,r]of Object.entries(t))e[n]=1;if(n)for(const[t,r]of Object.entries(n))e[t]=1;return e},parse=function(t,n){if(null==t)return{};if(void 0!==n){if(0==t||t<0||0==n||n<0)throw"non-positive number cannot be converted into an interval";const e=pf.getPrimeExponentObject(t),r=pf.getPrimeExponentObject(n);let o=keys(e,r);for(const t in o)o[t]=Fraction((e[t]||0)-(r[t]||0));return o}if("object"==typeof t){if("d"in t&&"n"in t){let n=t.n;return"s"in t&&(n*=t.s),parse(n,t.d)}{let n=!0,e={};for(const r in keys(t))n&=pf.isPrime(Number(r)),0!=Fraction(t[r])&&(e[r]=Fraction(t[r]));if(n)return e;throw"argument is not a number, fraction, or interval"}}return parse(Fraction(t))};function Interval(t,n){if(!(this instanceof Interval))return new Interval(t,n);const e=parse(t,n);for(const t in keys(e))this[t]=e[t]}Interval.prototype={mul:function(t,n){const e=parse(t,n);let r=keys(this,e);for(const t in r)r[t]=(this[t]||Fraction(0)).add(e[t]||Fraction(0));return new Interval(r)},div:function(t,n){const e=parse(t,n);let r=keys(this,e);for(const t in r)r[t]=(this[t]||Fraction(0)).sub(e[t]||Fraction(0));return new Interval(r)},recip:function(){let t=keys(this);for(const n in t)t[n]=this[n].neg();return new Interval(t)},pow:function(t,n){let e=keys(this);for(const r in e)e[r]=this[r].mul(Fraction(t,n));return new Interval(e)},root:function(t){return this.pow(Fraction(1,t))},sqrt:function(){return this.pow(.5)},isFrac:function(){for(const t in keys(this))if(1!=this[t].d)return!1;return!0},toFrac:function(){let t=Fraction(1);for(const n in keys(this)){if(1!=this[n].d)throw"interval does not have integer exponents";t=t.mul(Fraction(n).pow(this[n].s*this[n].n))}return t},med:function(t,n){let[e,r]=[this.toFrac(),Interval(t,n).toFrac()];return new Interval(e.n+r.n,e.d+r.d)},toNthRoot:function(){let t=Fraction(1);for(const n in keys(this))t=t.gcd(this[n]);return{k:this.pow(t.inverse()).toFrac(),n:t.d}},valueOf:function(){let t=1;for(const n in keys(this))t*=Math.pow(n,this[n].valueOf());return t},compare:function(t,n){const e=this.div(t,n),{k:r,n:o}=e.toNthRoot();return isFinite(r.n)&&isFinite(r.d)?r.compare(Fraction(1)):(1<e.valueOf())-(e.valueOf()<1)},equals:function(t,n){return 0==this.compare(t,n)},factorOut:function(t,n){const e=new Interval(t,n),r=Math.max(...Object.keys(e));if(isFinite(r)){const t=(this[r]||Fraction(0)).div(e[r]);let n=keys(this,e);for(const r in n)n[r]=(this[r]||Fraction(0)).sub((e[r]||Fraction(0)).mul(t));return[t,new Interval(n)]}return[Fraction(0),this]},valueOf_log:function(t,n){let e=new Interval(2);null==t&&null==n||(e=new Interval(t,n));const[r,o]=this.factorOut(e);return r+Math.log(o.valueOf())/Math.log(e.valueOf())},red:function(t,n){let e=new Interval(2);null==t&&null==n||(e=new Interval(t,n));const r=Math.floor(this.valueOf_log(e));return this.div(e.pow(r))},reb:function(t,n){let e=new Interval(2);null==t&&null==n||(e=new Interval(t,n));const r=Math.round(this.valueOf_log(e));return this.div(e.pow(r))},toCents:function(){const[t,n]=this.factorOut(2);return t.mul(1200)+Math.log(n.valueOf())/Math.log(2)*1200},tenneyHD:function(){let t=Interval(1);for(const n in keys(this))t[n]=this[n].abs();return t.valueOf_log()},toMonzo:function(){let t=0;for(const n in keys(this))t=Math.max(t,n);let[n,e]=[[],!0];2<=t&&(n[0]=this[2]||Fraction(0),e&=!this[2]||1==this[2].d);let r=1;for(let o=3;o<=t;o+=2)pf.isPrime(o)&&(n[r]=this[o]||Fraction(0),e&=!this[o]||1==this[o].d,r++);return e&&(n=n.map(t=>t.s*t.n)),n}},module.exports=Interval;

},{"fraction.js":12,"primes-and-factors":16}],7:[function(require,module,exports){
const ne=require("nearley"),Fraction=require("fraction.js"),Interval=require("./interval.js"),grammar=require("./parser/grammar.js"),{evalExpr:evalExpr}=require("./parser/eval.js"),{isPythagorean:isPythagorean,pySymb:pySymb,pyNote:pyNote}=require("./pythagorean.js"),{fjsSymb:fjsSymb,fjsNote:fjsNote,nfjsParams:nfjsParams}=require("./fjs.js"),{edoApprox:edoApprox,edoPy:edoPy,updnsSymb:updnsSymb,updnsNote:updnsNote}=require("./edo.js"),{enNames:enNames}=require("./english.js");function mod(e,t){return(e%t+t)%t}function expectedSymbols(e){let t=[];const r=e.table.length-2;return e.table[r].states.filter(function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}).map(function(t){return e.buildFirstStateStack(t,[])||[t]},e).forEach(function(r){var s=r[0],n=s.rule.symbols[s.dot],o=e.getSymbolDisplay(n);t.push(o)},e),(t=[...new Set(t)]).sort((e,t)=>e.length-t.length),t.length>1&&(t[t.length-1]="or "+t[t.length-1]),"expected a "+t.join(", ")}function parse(e){const t=new ne.Parser(ne.Grammar.fromCompiled(grammar));try{t.feed(e)}catch(e){throw new Error("Parse error at col "+e.offset+", "+expectedSymbols(t))}let r=t.results;for(let e=0;e<r.length;e++){const t=evalExpr(r[e].expr,r[e].refNote);r[e].val=t.val,r[e].prefEDO=t.prefEDO}if(0==r.length)try{t.feed("$")}catch(e){throw new Error("Parse error at col "+e.offset+", "+expectedSymbols(t))}r.some(e=>"interval"==e.type[0]&&"symbol"==e.type[1])&&(r=r.filter(e=>!("interval"==e.type[0]&&"symbol"!=e.type[1]))),r.some(e=>"note"==e.type[0]&&"symbol"==e.type[1])&&(r=r.filter(e=>!("note"==e.type[0]&&"symbol"!=e.type[1]))),r.length>1&&(console.log("Parse was ambiguous! Full results:"),console.dir(t.results,{depth:null}));let s={type:r[0].type[0],intv:r[0].val,refNote:r[0].refNote,prefEDO:r[0].prefEDO};if(Object.entries(s.intv).length==(null!=s.intv[2])){let e=s.intv[2]||Fraction(0);s.prefEDO&&1!=e.mul(s.prefEDO).d&&delete s.prefEDO,s.prefEDO||2!=e.d&&3!=e.d&&4!=e.d||(s.prefEDO=12),!s.prefEDO&&4<e.d&&e.d<=60&&(s.prefEDO=e.d)}else delete s.prefEDO;return s}function parseCvt(e){let{type:t,intv:r,refNote:s,prefEDO:n}=parse(e),o={type:t};if("interval"==t){o.cents=r.toCents(),o.intv=r;try{o.ratio=r.toFrac(),o.tenneyHD=r.tenneyHD()}catch(e){}if(n){let e=(r[2]||Fraction(0)).mul(n);o.edoSteps=[e.s*e.n,n]}o.symb={};let e=fjsSymb(r),t=fjsSymb(r,nfjsParams);if(e&&(o.symb.FJS=e),t&&t!=e&&(o.symb["Neutral FJS"]=t),n){let e=(r[2]||Fraction(0)).mul(n);o.symb["ups-and-downs"]=updnsSymb(n,e.s*e.n).map(e=>e+"\\"+n)}!t&&isPythagorean(r)&&(o.symb.other=pySymb(r)),r.equals(Interval(2).sqrt())&&(o.symb.other="TT");const s=enNames(r,{prefEDO:n});s.length>0&&(o.english=s)}if("note"==t){o.hertz=s.hertz.mul(r).valueOf();const e=r.mul(s.intvToA4),t=edoApprox(12,e),a=e.div(Interval(2).pow(t,12)).toCents();if(o.tuningMeter=updnsNote(12,mod(t+9,12)-9).join("/")+" "+(0==a?"±":a>0?"+":"-")+Math.abs(a).toFixed(1)+"c",o.intvToRef=r,n){let e=(r[2]||Fraction(0)).mul(n);o.edoStepsToRef=[e.s*e.n,n]}o.ref={hertz:s.hertz.valueOf(),intvToA4:s.intvToA4},o.symb={};let l=fjsNote(e);if(l&&(o.symb.FJS=l),n){const e=edoPy(n,s.intvToA4);o.ref.edoStepsToA4=[e,n];let t=(r[2]||Fraction(0)).mul(n).add(e);o.symb["ups-and-downs"]=updnsNote(n,t.s*t.n).map(e=>e+"\\"+n)}}return o}module.exports.parse=parse,module.exports.parseCvt=parseCvt;

},{"./edo.js":2,"./english.js":3,"./fjs.js":4,"./interval.js":6,"./parser/eval.js":8,"./parser/grammar.js":10,"./pythagorean.js":11,"fraction.js":12,"nearley":14}],8:[function(require,module,exports){
const Fraction=require("fraction.js"),Interval=require("../interval.js"),{pyInterval:pyInterval,isPerfectDeg:isPerfectDeg,baseNoteIntvToA:baseNoteIntvToA}=require("../pythagorean.js"),{fjsFactor:fjsFactor}=require("../fjs.js"),{edoApprox:edoApprox,edoPy:edoPy,edoHasNeutrals:edoHasNeutrals,edoHasSemiNeutrals:edoHasSemiNeutrals}=require("../edo.js");function cbnEDOs(e,r){return e&&r?Fraction(1,e).gcd(1,r).d:void 0}function evalExpr(e,r,a){if(Array.isArray(e)){if(Array.isArray(e[0]))return console.log("evalExpr: nested arrays"),evalExpr(e[0],r,a);if("!refIntvToA4"==e[0])return{val:r.intvToA4};if("!refHertz"==e[0])return{val:r.hertz};if("!med"==e[0]){const a=evalExpr(e[1],r).val,t=evalExpr(e[2],r).val;if(a.isFrac()&&t.isFrac())return{val:a.med(t)};throw"One of the arguments to `med` is not a fraction"}if("!cents"==e[0]){const a=Fraction(evalExpr(e[1],r).val).div(1200);return{val:Interval(2).pow(a),prefEDO:48%a.d==0?24%a.d==0?12%a.d==0?12:24:48:void 0}}if("!edoApprox"==e[0]){const a=evalExpr(e[1],r).val,t=evalExpr(e[2],r).val;return{val:Interval(2).pow(edoApprox(t,a)).pow(1,t),prefEDO:t}}if("!inEDO"==e[0]){const a=evalExpr(e[2],r).val,t=evalExpr(e[1],r,a).val;return{val:Interval(2).pow(t).pow(1,a),prefEDO:a}}if("!edoTT"==e[0]){if(a%2==0)return{val:a/2};throw a+"-EDO does not have a tritone"}if("!edoPy"==e[0]){const t=evalExpr(e[1],r,a).val;return{val:edoPy(a,t)}}const t=e.slice(1).map(e=>evalExpr(e,r,a));if("+"==e[0])return{val:t[0].val+t[1].val};if("-"==e[0])return{val:t[0].val-t[1].val};if("*"==e[0])return{val:t[0].val*t[1].val};if("/"==e[0])return{val:t[0].val/t[1].val};let l={val:t[0].val[e[0]](...t.slice(1).map(e=>e.val)),prefEDO:t.map(e=>e.prefEDO).reduce(cbnEDOs)};return"pow"==e[0]&&(l.prefEDO=t[0].prefEDO),"red"!=e[0]&&"reb"!=e[0]||(t[1]&&t[1].equals&&t[1].equals(2)?l.prefEDO=t[0].prefEDO:l.prefEDO=void 0),l}return{val:e,prefEDO:2==e?1:void 0}}module.exports.evalExpr=evalExpr;

},{"../edo.js":2,"../fjs.js":4,"../interval.js":6,"../pythagorean.js":11,"fraction.js":12}],9:[function(require,module,exports){
const Fraction=require("fraction.js"),Interval=require("../interval.js"),{pyInterval:pyInterval,isPerfectDeg:isPerfectDeg,baseNoteIntvToA:baseNoteIntvToA}=require("../pythagorean.js"),{fjsFactor:fjsFactor}=require("../fjs.js"),{edoPy:edoPy,edoHasNeutrals:edoHasNeutrals,edoHasSemiNeutrals:edoHasSemiNeutrals}=require("../edo.js"),defaultRefNote={intvToA4:Interval(1),hertz:Interval(440)};function perfPyInterval(e,r,t){return isPerfectDeg(e)?pyInterval(e,r):t}function nonPerfPyInterval(e,r,t){return isPerfectDeg(e)?t:pyInterval(e,r)}function augOrDimPyInterval(e,r,t,n){const o=Fraction(r,t);if(o.d!=t)return n;const a=o.add(o.s,2);return isPerfectDeg(e)?pyInterval(e,o):pyInterval(e,a)}function ensureNo2Or3(e,r){return e[2]&&0!=e[2]||e[3]&&0!=e[3]?r:e}function cbnEDOs(e,r){return e&&r?Fraction(1,e).gcd(1,r).d:null}function baseNoteIntvToReference(e,r){return baseNoteIntvToA(e).div(r)}module.exports.defaultRefNote=defaultRefNote,module.exports.perfPyInterval=perfPyInterval,module.exports.nonPerfPyInterval=nonPerfPyInterval,module.exports.augOrDimPyInterval=augOrDimPyInterval,module.exports.ensureNo2Or3=ensureNo2Or3,module.exports.cbnEDOs=cbnEDOs,module.exports.baseNoteIntvToReference=baseNoteIntvToReference;

},{"../edo.js":2,"../fjs.js":4,"../interval.js":6,"../pythagorean.js":11,"fraction.js":12}],10:[function(require,module,exports){
!function(){function s(s){return s[0]}const e=require("fraction.js"),n=require("../interval.js"),{pyInterval:t,pyRedDeg:o,baseNoteIntvToA:r}=require("../pythagorean.js"),{fjsFactor:p,fjsParams:l,nfjsParams:a}=require("../fjs.js"),{edoPy:i}=require("../edo.js"),c=require("./grammar-helpers.js"),{evalExpr:m}=require("./eval.js");var $={Lexer:void 0,ParserRules:[{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1","wschar"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:function(s){return null}},{name:"__$ebnf$1",symbols:["wschar"]},{name:"__$ebnf$1",symbols:["__$ebnf$1","wschar"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"__",symbols:["__$ebnf$1"],postprocess:function(s){return null}},{name:"wschar",symbols:[/[ \t\n\v\f]/],postprocess:s},{name:"top1",symbols:["_","top2","_"],postprocess:function(s,e,n){let t=Object.assign({},s[1]);return t.refNote=c.defaultRefNote,t}},{name:"top1$string$1",symbols:[{literal:"w"},{literal:"h"},{literal:"e"},{literal:"r"},{literal:"e"}],postprocess:function(s){return s.join("")}},{name:"top1$ebnf$1",symbols:["hertz"],postprocess:s},{name:"top1$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"top1",symbols:["_","top2","__","top1$string$1","__","pyNote","_",{literal:"="},"_","decimal","top1$ebnf$1","_"],postprocess:function(s,e,t){let o=Object.assign({},s[1]);return o.refNote={},o.refNote.intvToA4=m(s[5],c.defaultRefNote).val,o.refNote.hertz=n(s[9]),o}},{name:"top1$string$2",symbols:[{literal:"w"},{literal:"h"},{literal:"e"},{literal:"r"},{literal:"e"}],postprocess:function(s){return s.join("")}},{name:"top1",symbols:["_","top2","__","top1$string$2","__","pyNote","_",{literal:"="},"_","pyNote","_",{literal:"\\"},"_","posInt","_"],postprocess:function(s,e,t){let o=Object.assign({},s[1]);const r=m(s[5],c.defaultRefNote).val,p=m(s[9],c.defaultRefNote).val,l=parseInt(s[13]);return r&&r.equals(p)?(o.refNote={},o.refNote.intvToA4=p,o.refNote.hertz=n(2).pow(i(l,p),l).mul(440),o):t}},{name:"top2",symbols:["intvSExpr1"],postprocess:s=>({type:["interval","symbol"],expr:s[0]})},{name:"top2",symbols:["intvMExpr1"],postprocess:s=>({type:["interval","multiplicative"],expr:s[0]})},{name:"top2",symbols:["intvAExpr1"],postprocess:s=>({type:["interval","additive"],expr:s[0]})},{name:"top2",symbols:["noteSExpr1"],postprocess:s=>({type:["note","symbol"],expr:s[0]})},{name:"top2",symbols:["noteMExpr1"],postprocess:s=>({type:["note","multiplicative"],expr:s[0]})},{name:"top2",symbols:["noteAExpr1"],postprocess:s=>({type:["note","additive"],expr:s[0]})},{name:"intvMExpr1",symbols:["intvMExpr1","_",{literal:"*"},"_","intvMExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"intvMExpr1",symbols:["intvMExpr1","_",{literal:"/"},"_","intvMExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"intvMExpr1",symbols:["noteMExpr1","_",{literal:"/"},"_","noteMExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"intvMExpr1",symbols:["intvMExpr2"],postprocess:s},{name:"intvMExpr2",symbols:["intvMExpr3","_",{literal:"^"},"_","frcExpr3"],postprocess:s=>["pow",s[0],s[4]]},{name:"intvMExpr2$string$1",symbols:[{literal:"s"},{literal:"q"},{literal:"r"},{literal:"t"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$1","_",{literal:"("},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["sqrt",s[4]]},{name:"intvMExpr2$string$2",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$2","_",{literal:"("},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["red",s[4]]},{name:"intvMExpr2$string$3",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$3","_",{literal:"("},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4]]},{name:"intvMExpr2$string$4",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$4","_",{literal:"("},"_","intvMExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["red",s[4],s[8]]},{name:"intvMExpr2$string$5",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$5","_",{literal:"("},"_","intvMExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4],s[8]]},{name:"intvMExpr2$string$6",symbols:[{literal:"m"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$6","_",{literal:"("},"_","intvMExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["!med",s[4],s[8]]},{name:"intvMExpr2$string$7",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"intvMExpr2",symbols:["intvMExpr2$string$7","_",{literal:"("},"_","intvMExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"intvMExpr2",symbols:["intvSymbol"],postprocess:s},{name:"intvMExpr2",symbols:["intvMExpr3"],postprocess:s},{name:"intvMExpr3",symbols:["posInt"],postprocess:s=>n(s[0])},{name:"intvMExpr3",symbols:["int","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",parseInt(s[0]),parseInt(s[4])]},{name:"intvMExpr3",symbols:["intvMEDOExpr3","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"intvMExpr3",symbols:[{literal:"("},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"noteMExpr1",symbols:["noteMExpr1","_",{literal:"*"},"_","intvMExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"noteMExpr1",symbols:["intvMExpr1","_",{literal:"*"},"_","noteMExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"noteMExpr1",symbols:["noteMExpr1","_",{literal:"/"},"_","intvMExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"noteMExpr1",symbols:["noteMExpr2"],postprocess:s},{name:"noteMExpr2$string$1",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"noteMExpr2",symbols:["noteMExpr2$string$1","_",{literal:"("},"_","noteMExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"noteMExpr2",symbols:["noteSymbol"],postprocess:s},{name:"noteMExpr2",symbols:["noteMEDOExpr2","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"noteMExpr2",symbols:["decimal","hertz"],postprocess:s=>["div",n(s[0]),["!refHertz"]]},{name:"noteMExpr2",symbols:[{literal:"("},"_","noteMExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intvAExpr1",symbols:["intvAExpr1","_",{literal:"+"},"_","intvAExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"intvAExpr1",symbols:["intvAExpr1","_",{literal:"-"},"_","intvAExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"intvAExpr1",symbols:["noteAExpr1","_",{literal:"-"},"_","noteAExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"intvAExpr1",symbols:["intvAExpr2"],postprocess:s},{name:"intvAExpr2",symbols:["intvAExpr3","_",{literal:"x"},"_","frcExpr3"],postprocess:s=>["pow",s[0],s[4]]},{name:"intvAExpr2",symbols:["frcExpr3","_",{literal:"x"},"_","intvAExpr3"],postprocess:s=>["pow",s[4],s[0]]},{name:"intvAExpr2",symbols:["intvAExpr3"],postprocess:s},{name:"intvAExpr3$string$1",symbols:[{literal:"c"},{literal:"e"},{literal:"n"},{literal:"t"},{literal:"s"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$1","_",{literal:"("},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>s[4]},{name:"intvAExpr3$string$2",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$2","_",{literal:"("},"_","intvAExpr1","_",{literal:")"}],postprocess:s=>["red",s[4]]},{name:"intvAExpr3$string$3",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$3","_",{literal:"("},"_","intvAExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4]]},{name:"intvAExpr3$string$4",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$4","_",{literal:"("},"_","intvAExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["red",s[4],s[8]]},{name:"intvAExpr3$string$5",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$5","_",{literal:"("},"_","intvAExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4],s[8]]},{name:"intvAExpr3$string$6",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"intvAExpr3",symbols:["intvAExpr3$string$6","_",{literal:"("},"_","intvAExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"intvAExpr3",symbols:["intvSymbol"],postprocess:s},{name:"intvAExpr3",symbols:["intvAExpr4"],postprocess:s},{name:"intvAExpr4",symbols:["decimal",{literal:"c"}],postprocess:s=>["!cents",s[0]]},{name:"intvAExpr4",symbols:["intvAEDOExpr3","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"intvAExpr4",symbols:[{literal:"("},"_","intvAExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"noteAExpr1",symbols:["noteAExpr1","_",{literal:"+"},"_","intvAExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"noteAExpr1",symbols:["intvAExpr1","_",{literal:"+"},"_","noteAExpr2"],postprocess:s=>["mul",s[0],s[4]]},{name:"noteAExpr1",symbols:["noteAExpr1","_",{literal:"-"},"_","intvAExpr2"],postprocess:s=>["div",s[0],s[4]]},{name:"noteAExpr1",symbols:["noteAExpr2"],postprocess:s},{name:"noteAExpr2$string$1",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"noteAExpr2",symbols:["noteAExpr2$string$1","_",{literal:"("},"_","noteAExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"noteAExpr2",symbols:["noteSymbol"],postprocess:s},{name:"noteAExpr2",symbols:["noteAEDOExpr2","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"noteAExpr2",symbols:[{literal:"("},"_","noteAExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intvMEDOExpr1",symbols:["intvMEDOExpr1","_",{literal:"*"},"_","intvMEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"intvMEDOExpr1",symbols:["intvMEDOExpr1","_",{literal:"/"},"_","intvMEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"intvMEDOExpr1",symbols:["noteMEDOExpr1","_",{literal:"/"},"_","noteMEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"intvMEDOExpr1",symbols:["intvMEDOExpr2"],postprocess:s},{name:"intvMEDOExpr2",symbols:["intvMEDOExpr3","_",{literal:"^"},"_","intExpr1"],postprocess:s=>["*",s[0],s[4]]},{name:"intvMEDOExpr2",symbols:["intvMEDOExpr3"],postprocess:s},{name:"intvMEDOExpr3",symbols:["upsDnsIntv"],postprocess:s},{name:"intvMEDOExpr3$string$1",symbols:[{literal:"T"},{literal:"T"}],postprocess:function(s){return s.join("")}},{name:"intvMEDOExpr3",symbols:["intvMEDOExpr3$string$1"],postprocess:s=>["!edoTT"]},{name:"intvMEDOExpr3",symbols:[{literal:"("},"_","intvMEDOExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"noteMEDOExpr1",symbols:["noteMEDOExpr1","_",{literal:"*"},"_","intvMEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"noteMEDOExpr1",symbols:["intvMEDOExpr1","_",{literal:"*"},"_","noteMEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"noteMEDOExpr1",symbols:["noteMEDOExpr1","_",{literal:"/"},"_","intvMEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"noteMEDOExpr1",symbols:["noteMEDOExpr2"],postprocess:s},{name:"noteMEDOExpr2",symbols:["upsDnsNote"],postprocess:s},{name:"noteMEDOExpr2",symbols:[{literal:"("},"_","noteMEDOExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intvAEDOExpr1",symbols:["intvAEDOExpr1","_",{literal:"+"},"_","intvAEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"intvAEDOExpr1",symbols:["intvAEDOExpr1","_",{literal:"-"},"_","intvAEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"intvAEDOExpr1",symbols:["noteAEDOExpr1","_",{literal:"-"},"_","noteAEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"intvAEDOExpr1",symbols:["intvAEDOExpr2"],postprocess:s},{name:"intvAEDOExpr2",symbols:["intvAEDOExpr3","_",{literal:"x"},"_","intExpr1"],postprocess:s=>["*",s[0],s[4]]},{name:"intvAEDOExpr2",symbols:["intExpr1","_",{literal:"x"},"_","intvAEDOExpr3"],postprocess:s=>["*",s[0],s[4]]},{name:"intvAEDOExpr2",symbols:["intvAEDOExpr3"],postprocess:s},{name:"intvAEDOExpr3",symbols:[{literal:"-"},"_","intvAEDOExpr4"],postprocess:s=>["-",0,s[2]]},{name:"intvAEDOExpr3",symbols:["intvAEDOExpr4"],postprocess:s},{name:"intvAEDOExpr4",symbols:["nonNegInt"],postprocess:s=>parseInt(s[0])},{name:"intvAEDOExpr4",symbols:["upsDnsIntv"],postprocess:s},{name:"intvAEDOExpr4$string$1",symbols:[{literal:"T"},{literal:"T"}],postprocess:function(s){return s.join("")}},{name:"intvAEDOExpr4",symbols:["intvAEDOExpr4$string$1"],postprocess:s=>["!edoTT"]},{name:"intvAEDOExpr4",symbols:[{literal:"("},"_","intvAEDOExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"noteAEDOExpr1",symbols:["noteAEDOExpr1","_",{literal:"+"},"_","intvAEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"noteAEDOExpr1",symbols:["intvAEDOExpr1","_",{literal:"+"},"_","noteAEDOExpr2"],postprocess:s=>["+",s[0],s[4]]},{name:"noteAEDOExpr1",symbols:["noteAEDOExpr1","_",{literal:"-"},"_","intvAEDOExpr2"],postprocess:s=>["-",s[0],s[4]]},{name:"noteAEDOExpr1",symbols:["noteAEDOExpr2"],postprocess:s},{name:"noteAEDOExpr2",symbols:["upsDnsNote"],postprocess:s},{name:"noteAEDOExpr2",symbols:[{literal:"("},"_","noteAEDOExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intvSExpr1$string$1",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr1",symbols:["intvSExpr1$string$1","_",{literal:"("},"_","intvSExpr1","_",{literal:")"}],postprocess:s=>["red",s[4]]},{name:"intvSExpr1$string$2",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr1",symbols:["intvSExpr1$string$2","_",{literal:"("},"_","intvSExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4]]},{name:"intvSExpr1$string$3",symbols:[{literal:"r"},{literal:"e"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr1",symbols:["intvSExpr1$string$3","_",{literal:"("},"_","intvSExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["red",s[4],s[8]]},{name:"intvSExpr1$string$4",symbols:[{literal:"r"},{literal:"e"},{literal:"b"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr1",symbols:["intvSExpr1$string$4","_",{literal:"("},"_","intvSExpr1","_",{literal:","},"_","intvMExpr1","_",{literal:")"}],postprocess:s=>["reb",s[4],s[8]]},{name:"intvSExpr1$string$5",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr1",symbols:["intvSExpr1$string$5","_",{literal:"("},"_","intvSExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"intvSExpr1",symbols:["intvSExpr2"],postprocess:s},{name:"intvSExpr2",symbols:["intvSymbol"],postprocess:s},{name:"intvSExpr2",symbols:["int","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",parseInt(s[0]),parseInt(s[4])]},{name:"intvSExpr2",symbols:["upsDnsIntv","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"intvSExpr2$string$1",symbols:[{literal:"T"},{literal:"T"}],postprocess:function(s){return s.join("")}},{name:"intvSExpr2",symbols:["intvSExpr2$string$1","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",["!edoTT"],parseInt(s[4])]},{name:"intvSExpr2",symbols:[{literal:"("},"_","intvSExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"noteSExpr1$string$1",symbols:[{literal:"a"},{literal:"p"},{literal:"p"},{literal:"r"},{literal:"o"},{literal:"x"}],postprocess:function(s){return s.join("")}},{name:"noteSExpr1",symbols:["noteSExpr1$string$1","_",{literal:"("},"_","noteSExpr1","_",{literal:","},"_","posInt","_",{literal:")"}],postprocess:s=>["!edoApprox",s[4],parseInt(s[8])]},{name:"noteSExpr1",symbols:["noteSymbol"],postprocess:s},{name:"noteSExpr1",symbols:["upsDnsNote","_",{literal:"\\"},"_","posInt"],postprocess:s=>["!inEDO",s[0],parseInt(s[4])]},{name:"noteSExpr1",symbols:[{literal:"("},"_","noteSExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intvSymbol",symbols:["fjsIntv"],postprocess:s},{name:"intvSymbol",symbols:["nfjsNeutIntv"],postprocess:s},{name:"intvSymbol$string$1",symbols:[{literal:"N"},{literal:"F"},{literal:"J"},{literal:"S"}],postprocess:function(s){return s.join("")}},{name:"intvSymbol",symbols:["intvSymbol$string$1","_",{literal:"("},"_","nfjsIntv","_",{literal:")"}],postprocess:s=>s[4]},{name:"intvSymbol",symbols:["snpyIntv"],postprocess:s},{name:"intvSymbol$string$2",symbols:[{literal:"T"},{literal:"T"}],postprocess:function(s){return s.join("")}},{name:"intvSymbol",symbols:["intvSymbol$string$2"],postprocess:s=>n(2).sqrt()},{name:"noteSymbol",symbols:["fjsNote"],postprocess:s},{name:"noteSymbol",symbols:["nfjsNeutNote"],postprocess:s},{name:"noteSymbol$string$1",symbols:[{literal:"N"},{literal:"F"},{literal:"J"},{literal:"S"}],postprocess:function(s){return s.join("")}},{name:"noteSymbol",symbols:["noteSymbol$string$1","_",{literal:"("},"_","nfjsNote","_",{literal:")"}],postprocess:s=>s[4]},{name:"noteSymbol",symbols:["npyNote"],postprocess:s},{name:"pyIntv",symbols:[{literal:"P"},"pyDeg"],postprocess:(s,e,n)=>c.perfPyInterval(s[1],0,n)},{name:"pyIntv",symbols:[{literal:"M"},"pyDeg"],postprocess:(s,n,t)=>c.nonPerfPyInterval(s[1],e(1,2),t)},{name:"pyIntv",symbols:[{literal:"m"},"pyDeg"],postprocess:(s,n,t)=>c.nonPerfPyInterval(s[1],e(-1,2),t)},{name:"pyIntv$ebnf$1",symbols:[{literal:"A"}]},{name:"pyIntv$ebnf$1",symbols:["pyIntv$ebnf$1",{literal:"A"}],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyIntv",symbols:["pyIntv$ebnf$1","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[1],s[0].length,1,n)},{name:"pyIntv$ebnf$2",symbols:[{literal:"d"}]},{name:"pyIntv$ebnf$2",symbols:["pyIntv$ebnf$2",{literal:"d"}],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyIntv",symbols:["pyIntv$ebnf$2","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[1],-s[0].length,1,n)},{name:"pyIntv",symbols:["posInt",{literal:"A"},"pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],1,n)},{name:"pyIntv",symbols:["posInt",{literal:"d"},"pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],1,n)},{name:"npyIntv$subexpression$1",symbols:[/[nN]/],postprocess:function(s){return s.join("")}},{name:"npyIntv",symbols:["npyIntv$subexpression$1","pyDeg"],postprocess:(s,e,n)=>c.nonPerfPyInterval(s[1],0,n)},{name:"npyIntv$string$1",symbols:[{literal:"s"},{literal:"A"}],postprocess:function(s){return s.join("")}},{name:"npyIntv",symbols:["npyIntv$string$1","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[1],1,2,n)},{name:"npyIntv$string$2",symbols:[{literal:"s"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"npyIntv",symbols:["npyIntv$string$2","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[1],-1,2,n)},{name:"npyIntv$string$3",symbols:[{literal:"/"},{literal:"2"},{literal:"-"},{literal:"A"}],postprocess:function(s){return s.join("")}},{name:"npyIntv",symbols:["posInt","npyIntv$string$3","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],2,n)},{name:"npyIntv$string$4",symbols:[{literal:"/"},{literal:"2"},{literal:"-"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"npyIntv",symbols:["posInt","npyIntv$string$4","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],2,n)},{name:"snpyIntv$string$1",symbols:[{literal:"s"},{literal:"M"}],postprocess:function(s){return s.join("")}},{name:"snpyIntv",symbols:["snpyIntv$string$1","pyDeg"],postprocess:(s,n,t)=>c.nonPerfPyInterval(s[1],e(1,4),t)},{name:"snpyIntv$string$2",symbols:[{literal:"s"},{literal:"m"}],postprocess:function(s){return s.join("")}},{name:"snpyIntv",symbols:["snpyIntv$string$2","pyDeg"],postprocess:(s,n,t)=>c.nonPerfPyInterval(s[1],e(-1,4),t)},{name:"snpyIntv$string$3",symbols:[{literal:"/"},{literal:"4"},{literal:"-"},{literal:"A"}],postprocess:function(s){return s.join("")}},{name:"snpyIntv",symbols:["posInt","snpyIntv$string$3","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],4,n)},{name:"snpyIntv$string$4",symbols:[{literal:"/"},{literal:"4"},{literal:"-"},{literal:"d"}],postprocess:function(s){return s.join("")}},{name:"snpyIntv",symbols:["posInt","snpyIntv$string$4","pyDeg"],postprocess:(s,e,n)=>c.augOrDimPyInterval(s[2],s[0],4,n)},{name:"pyDeg",symbols:["posInt"],postprocess:s=>parseInt(s[0])},{name:"pyDeg",symbols:[{literal:"-"},"posInt"],postprocess:s=>-parseInt(s[1])},{name:"pyNote",symbols:[{literal:"A"}],postprocess:s=>["recip",["!refIntvToA4"]]},{name:"pyNote$macrocall$2",symbols:[/[B-G]/]},{name:"pyNote$macrocall$3",symbols:["pyNoteNoAccs"]},{name:"pyNote$macrocall$1$ebnf$1",symbols:["int"],postprocess:s},{name:"pyNote$macrocall$1$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"pyNote$macrocall$1",symbols:["pyNote$macrocall$2","pyNote$macrocall$3","pyNote$macrocall$1$ebnf$1"],postprocess:function(s){const e=s[2]?parseInt(s[2]):4;return["mul",["div",r(s[0][0]),["!refIntvToA4"]],s[1][0].mul(n(2).pow(e-4))]}},{name:"pyNote",symbols:["pyNote$macrocall$1"],postprocess:s},{name:"pyNote$macrocall$5",symbols:[/[A-G]/]},{name:"pyNote$macrocall$6",symbols:["pyNoteAccs"]},{name:"pyNote$macrocall$4$ebnf$1",symbols:["int"],postprocess:s},{name:"pyNote$macrocall$4$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"pyNote$macrocall$4",symbols:["pyNote$macrocall$5","pyNote$macrocall$6","pyNote$macrocall$4$ebnf$1"],postprocess:function(s){const e=s[2]?parseInt(s[2]):4;return["mul",["div",r(s[0][0]),["!refIntvToA4"]],s[1][0].mul(n(2).pow(e-4))]}},{name:"pyNote",symbols:["pyNote$macrocall$4"],postprocess:s},{name:"pyNoteNoAccs",symbols:[],postprocess:s=>n(1)},{name:"pyNoteAccs$subexpression$1",symbols:[{literal:"♮"}]},{name:"pyNoteAccs$subexpression$1$string$1",symbols:[{literal:"n"},{literal:"a"},{literal:"t"}],postprocess:function(s){return s.join("")}},{name:"pyNoteAccs$subexpression$1",symbols:["pyNoteAccs$subexpression$1$string$1"]},{name:"pyNoteAccs",symbols:["pyNoteAccs$subexpression$1"],postprocess:s=>n(1)},{name:"pyNoteAccs$ebnf$1$subexpression$1",symbols:[{literal:"♯"}]},{name:"pyNoteAccs$ebnf$1$subexpression$1",symbols:[{literal:"#"}]},{name:"pyNoteAccs$ebnf$1",symbols:["pyNoteAccs$ebnf$1$subexpression$1"]},{name:"pyNoteAccs$ebnf$1$subexpression$2",symbols:[{literal:"♯"}]},{name:"pyNoteAccs$ebnf$1$subexpression$2",symbols:[{literal:"#"}]},{name:"pyNoteAccs$ebnf$1",symbols:["pyNoteAccs$ebnf$1","pyNoteAccs$ebnf$1$subexpression$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs",symbols:["pyNoteAccs$ebnf$1"],postprocess:s=>t(1,s[0].length)},{name:"pyNoteAccs$ebnf$2$subexpression$1$string$1",symbols:[{literal:"\ud834"},{literal:"\udd2a"}],postprocess:function(s){return s.join("")}},{name:"pyNoteAccs$ebnf$2$subexpression$1",symbols:["pyNoteAccs$ebnf$2$subexpression$1$string$1"]},{name:"pyNoteAccs$ebnf$2$subexpression$1",symbols:[{literal:"X"}]},{name:"pyNoteAccs$ebnf$2",symbols:["pyNoteAccs$ebnf$2$subexpression$1"]},{name:"pyNoteAccs$ebnf$2$subexpression$2$string$1",symbols:[{literal:"\ud834"},{literal:"\udd2a"}],postprocess:function(s){return s.join("")}},{name:"pyNoteAccs$ebnf$2$subexpression$2",symbols:["pyNoteAccs$ebnf$2$subexpression$2$string$1"]},{name:"pyNoteAccs$ebnf$2$subexpression$2",symbols:[{literal:"X"}]},{name:"pyNoteAccs$ebnf$2",symbols:["pyNoteAccs$ebnf$2","pyNoteAccs$ebnf$2$subexpression$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs$ebnf$3",symbols:[]},{name:"pyNoteAccs$ebnf$3$subexpression$1",symbols:[{literal:"♯"}]},{name:"pyNoteAccs$ebnf$3$subexpression$1",symbols:[{literal:"#"}]},{name:"pyNoteAccs$ebnf$3",symbols:["pyNoteAccs$ebnf$3","pyNoteAccs$ebnf$3$subexpression$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs",symbols:["pyNoteAccs$ebnf$2","pyNoteAccs$ebnf$3"],postprocess:s=>t(1,2*s[0].length+s[1].length)},{name:"pyNoteAccs$ebnf$4$subexpression$1",symbols:[{literal:"♭"}]},{name:"pyNoteAccs$ebnf$4$subexpression$1",symbols:[{literal:"b"}]},{name:"pyNoteAccs$ebnf$4",symbols:["pyNoteAccs$ebnf$4$subexpression$1"]},{name:"pyNoteAccs$ebnf$4$subexpression$2",symbols:[{literal:"♭"}]},{name:"pyNoteAccs$ebnf$4$subexpression$2",symbols:[{literal:"b"}]},{name:"pyNoteAccs$ebnf$4",symbols:["pyNoteAccs$ebnf$4","pyNoteAccs$ebnf$4$subexpression$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs",symbols:["pyNoteAccs$ebnf$4"],postprocess:s=>t(-1,s[0].length)},{name:"pyNoteAccs$ebnf$5",symbols:[]},{name:"pyNoteAccs$ebnf$5$subexpression$1",symbols:[{literal:"♭"}]},{name:"pyNoteAccs$ebnf$5$subexpression$1",symbols:[{literal:"b"}]},{name:"pyNoteAccs$ebnf$5",symbols:["pyNoteAccs$ebnf$5","pyNoteAccs$ebnf$5$subexpression$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs$ebnf$6$string$1",symbols:[{literal:"\ud834"},{literal:"\udd2b"}],postprocess:function(s){return s.join("")}},{name:"pyNoteAccs$ebnf$6",symbols:["pyNoteAccs$ebnf$6$string$1"]},{name:"pyNoteAccs$ebnf$6$string$2",symbols:[{literal:"\ud834"},{literal:"\udd2b"}],postprocess:function(s){return s.join("")}},{name:"pyNoteAccs$ebnf$6",symbols:["pyNoteAccs$ebnf$6","pyNoteAccs$ebnf$6$string$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"pyNoteAccs",symbols:["pyNoteAccs$ebnf$5","pyNoteAccs$ebnf$6"],postprocess:s=>t(-1,2*s[0].length+s[1].length)},{name:"npyNote$macrocall$2",symbols:[/[A-G]/]},{name:"npyNote$macrocall$3",symbols:["npyNoteAccs"]},{name:"npyNote$macrocall$1$ebnf$1",symbols:["int"],postprocess:s},{name:"npyNote$macrocall$1$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"npyNote$macrocall$1",symbols:["npyNote$macrocall$2","npyNote$macrocall$3","npyNote$macrocall$1$ebnf$1"],postprocess:function(s){const e=s[2]?parseInt(s[2]):4;return["mul",["div",r(s[0][0]),["!refIntvToA4"]],s[1][0].mul(n(2).pow(e-4))]}},{name:"npyNote",symbols:["npyNote$macrocall$1"],postprocess:s},{name:"npyNoteAccs$ebnf$1",symbols:[]},{name:"npyNoteAccs$ebnf$1$subexpression$1$string$1",symbols:[{literal:"\ud834"},{literal:"\udd2a"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$1$subexpression$1",symbols:["npyNoteAccs$ebnf$1$subexpression$1$string$1"]},{name:"npyNoteAccs$ebnf$1$subexpression$1",symbols:[{literal:"X"}]},{name:"npyNoteAccs$ebnf$1",symbols:["npyNoteAccs$ebnf$1","npyNoteAccs$ebnf$1$subexpression$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs$ebnf$2",symbols:[]},{name:"npyNoteAccs$ebnf$2$subexpression$1",symbols:[{literal:"♯"}]},{name:"npyNoteAccs$ebnf$2$subexpression$1",symbols:[{literal:"#"}]},{name:"npyNoteAccs$ebnf$2",symbols:["npyNoteAccs$ebnf$2","npyNoteAccs$ebnf$2$subexpression$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs$ebnf$3$subexpression$1$string$1",symbols:[{literal:"\ud834"},{literal:"\udd32"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$3$subexpression$1",symbols:["npyNoteAccs$ebnf$3$subexpression$1$string$1"]},{name:"npyNoteAccs$ebnf$3$subexpression$1",symbols:[{literal:"t"}]},{name:"npyNoteAccs$ebnf$3",symbols:["npyNoteAccs$ebnf$3$subexpression$1"]},{name:"npyNoteAccs$ebnf$3$subexpression$2$string$1",symbols:[{literal:"\ud834"},{literal:"\udd32"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$3$subexpression$2",symbols:["npyNoteAccs$ebnf$3$subexpression$2$string$1"]},{name:"npyNoteAccs$ebnf$3$subexpression$2",symbols:[{literal:"t"}]},{name:"npyNoteAccs$ebnf$3",symbols:["npyNoteAccs$ebnf$3","npyNoteAccs$ebnf$3$subexpression$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs",symbols:["npyNoteAccs$ebnf$1","npyNoteAccs$ebnf$2","npyNoteAccs$ebnf$3"],postprocess:s=>t(1,2*s[0].length+s[1].length+.5*s[2].length)},{name:"npyNoteAccs$ebnf$4$subexpression$1$string$1",symbols:[{literal:"\ud834"},{literal:"\udd33"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$4$subexpression$1",symbols:["npyNoteAccs$ebnf$4$subexpression$1$string$1"]},{name:"npyNoteAccs$ebnf$4$subexpression$1",symbols:[{literal:"d"}]},{name:"npyNoteAccs$ebnf$4",symbols:["npyNoteAccs$ebnf$4$subexpression$1"]},{name:"npyNoteAccs$ebnf$4$subexpression$2$string$1",symbols:[{literal:"\ud834"},{literal:"\udd33"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$4$subexpression$2",symbols:["npyNoteAccs$ebnf$4$subexpression$2$string$1"]},{name:"npyNoteAccs$ebnf$4$subexpression$2",symbols:[{literal:"d"}]},{name:"npyNoteAccs$ebnf$4",symbols:["npyNoteAccs$ebnf$4","npyNoteAccs$ebnf$4$subexpression$2"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs$ebnf$5",symbols:[]},{name:"npyNoteAccs$ebnf$5$subexpression$1",symbols:[{literal:"♭"}]},{name:"npyNoteAccs$ebnf$5$subexpression$1",symbols:[{literal:"b"}]},{name:"npyNoteAccs$ebnf$5",symbols:["npyNoteAccs$ebnf$5","npyNoteAccs$ebnf$5$subexpression$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs$ebnf$6",symbols:[]},{name:"npyNoteAccs$ebnf$6$string$1",symbols:[{literal:"\ud834"},{literal:"\udd2b"}],postprocess:function(s){return s.join("")}},{name:"npyNoteAccs$ebnf$6",symbols:["npyNoteAccs$ebnf$6","npyNoteAccs$ebnf$6$string$1"],postprocess:function(s){return s[0].concat([s[1]])}},{name:"npyNoteAccs",symbols:["npyNoteAccs$ebnf$4","npyNoteAccs$ebnf$5","npyNoteAccs$ebnf$6"],postprocess:s=>t(-1,2*s[0].length+s[1].length+.5*s[2].length)},{name:"fjsIntv$macrocall$2",symbols:["pyIntv"]},{name:"fjsIntv$macrocall$3",symbols:["fjsIntv"]},{name:"fjsIntv$macrocall$1",symbols:["fjsIntv$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"fjsIntv$macrocall$1",symbols:["fjsIntv$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"fjsIntv$macrocall$1",symbols:["fjsIntv$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"fjsIntv",symbols:["fjsIntv$macrocall$1"],postprocess:s=>s[0](l)},{name:"fjsNote$macrocall$2",symbols:["pyNote"]},{name:"fjsNote$macrocall$3",symbols:["fjsNote"]},{name:"fjsNote$macrocall$1",symbols:["fjsNote$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"fjsNote$macrocall$1",symbols:["fjsNote$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"fjsNote$macrocall$1",symbols:["fjsNote$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"fjsNote",symbols:["fjsNote$macrocall$1"],postprocess:s=>s[0](l)},{name:"nfjsIntv",symbols:["nfjsNeutIntv"],postprocess:s},{name:"nfjsIntv",symbols:["nfjsNonNeutIntv"],postprocess:s},{name:"nfjsNote",symbols:["nfjsNeutNote"],postprocess:s},{name:"nfjsNote",symbols:["nfjsNonNeutNote"],postprocess:s},{name:"nfjsNeutIntv$macrocall$2",symbols:["npyIntv"]},{name:"nfjsNeutIntv$macrocall$3",symbols:["nfjsNeutIntv"]},{name:"nfjsNeutIntv$macrocall$1",symbols:["nfjsNeutIntv$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"nfjsNeutIntv$macrocall$1",symbols:["nfjsNeutIntv$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"nfjsNeutIntv$macrocall$1",symbols:["nfjsNeutIntv$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"nfjsNeutIntv",symbols:["nfjsNeutIntv$macrocall$1"],postprocess:s=>s[0](a)},{name:"nfjsNonNeutIntv$macrocall$2",symbols:["pyIntv"]},{name:"nfjsNonNeutIntv$macrocall$3",symbols:["nfjsNonNeutIntv"]},{name:"nfjsNonNeutIntv$macrocall$1",symbols:["nfjsNonNeutIntv$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"nfjsNonNeutIntv$macrocall$1",symbols:["nfjsNonNeutIntv$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"nfjsNonNeutIntv$macrocall$1",symbols:["nfjsNonNeutIntv$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"nfjsNonNeutIntv",symbols:["nfjsNonNeutIntv$macrocall$1"],postprocess:s=>s[0](a)},{name:"nfjsNeutNote$macrocall$2",symbols:["npyNote"]},{name:"nfjsNeutNote$macrocall$3",symbols:["nfjsNeutNote"]},{name:"nfjsNeutNote$macrocall$1",symbols:["nfjsNeutNote$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"nfjsNeutNote$macrocall$1",symbols:["nfjsNeutNote$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"nfjsNeutNote$macrocall$1",symbols:["nfjsNeutNote$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"nfjsNeutNote",symbols:["nfjsNeutNote$macrocall$1"],postprocess:s=>s[0](a)},{name:"nfjsNonNeutNote$macrocall$2",symbols:["pyNote"]},{name:"nfjsNonNeutNote$macrocall$3",symbols:["nfjsNonNeutNote"]},{name:"nfjsNonNeutNote$macrocall$1",symbols:["nfjsNonNeutNote$macrocall$2"],postprocess:s=>e=>s[0][0]},{name:"nfjsNonNeutNote$macrocall$1",symbols:["nfjsNonNeutNote$macrocall$3",{literal:"^"},"fjsAccs"],postprocess:s=>e=>["mul",s[0][0],s[2](e)]},{name:"nfjsNonNeutNote$macrocall$1",symbols:["nfjsNonNeutNote$macrocall$3",{literal:"_"},"fjsAccs"],postprocess:s=>e=>["div",s[0][0],s[2](e)]},{name:"nfjsNonNeutNote",symbols:["nfjsNonNeutNote$macrocall$1"],postprocess:s=>s[0](a)},{name:"fjsAccs",symbols:["fjsAcc"],postprocess:s=>e=>p(s[0],e)},{name:"fjsAccs",symbols:["fjsAccs",{literal:","},"fjsAcc"],postprocess:s=>e=>s[0](e).mul(p(s[2],e))},{name:"fjsAcc",symbols:["posInt"],postprocess:(s,e,t)=>c.ensureNo2Or3(n(s[0]),t)},{name:"fjsAcc$string$1",symbols:[{literal:"s"},{literal:"q"},{literal:"r"},{literal:"t"},{literal:"("}],postprocess:function(s){return s.join("")}},{name:"fjsAcc",symbols:["fjsAcc$string$1","fjsAcc",{literal:")"}],postprocess:s=>s[1].sqrt()},{name:"fjsAcc$string$2",symbols:[{literal:"r"},{literal:"o"},{literal:"o"},{literal:"t"}],postprocess:function(s){return s.join("")}},{name:"fjsAcc",symbols:["fjsAcc$string$2","posInt",{literal:"("},"fjsAcc",{literal:")"}],postprocess:s=>s[3].root(s[1])},{name:"fjsAcc",symbols:[{literal:"("},"fjsAcc",{literal:"^"},"frcExpr3",{literal:")"}],postprocess:s=>s[1].pow(s[3])},{name:"upsDnsIntv",symbols:["upsDns","pyIntv"],postprocess:s=>["+",s[0],["!edoPy",s[1]]]},{name:"upsDnsIntv",symbols:["upsDns","npyIntv"],postprocess:s=>["+",s[0],["!edoPy",s[1]]]},{name:"upsDnsIntv",symbols:["upsDns","snpyIntv"],postprocess:s=>["+",s[0],["!edoPy",s[1]]]},{name:"upsDnsIntv",symbols:["upsDns","posInt"],postprocess:(s,e,n)=>4!=o(s[1])&&5!=o(s[1])||0==s[0]?n:["+",s[0],["!edoPy",parseIng(s[1])]]},{name:"upsDnsIntv",symbols:["upsDns",{literal:"~"},"posInt"],postprocess:(s,e,n)=>1==o(s[2])?n:4==o(s[2])?["+",s[0],["!edoPy",t(s[2],1,2)]]:5==o(s[2])?["+",s[0],["!edoPy",t(s[2],-1,2)]]:["+",s[0],["!edoPy",t(s[2],0)]]},{name:"upsDnsNote",symbols:["upsDns","pyNote"],postprocess:s=>["+",s[0],["!edoPy",s[1]]]},{name:"upsDnsNote",symbols:["upsDns","npyNote"],postprocess:s=>["+",s[0],["!edoPy",s[1]]]},{name:"upsDns",symbols:[],postprocess:s=>0},{name:"upsDns$ebnf$1",symbols:[{literal:"^"}]},{name:"upsDns$ebnf$1",symbols:["upsDns$ebnf$1",{literal:"^"}],postprocess:function(s){return s[0].concat([s[1]])}},{name:"upsDns",symbols:["upsDns$ebnf$1"],postprocess:s=>s[0].length},{name:"upsDns$ebnf$2",symbols:[{literal:"v"}]},{name:"upsDns$ebnf$2",symbols:["upsDns$ebnf$2",{literal:"v"}],postprocess:function(s){return s[0].concat([s[1]])}},{name:"upsDns",symbols:["upsDns$ebnf$2"],postprocess:s=>-s[0].length},{name:"frcExpr1",symbols:["frcExpr1","_",{literal:"+"},"_","frcExpr2"],postprocess:s=>s[0].add(s[4])},{name:"frcExpr1",symbols:["frcExpr1","_",{literal:"-"},"_","frcExpr2"],postprocess:s=>s[0].sub(s[4])},{name:"frcExpr1",symbols:["frcExpr2"],postprocess:s},{name:"frcExpr2",symbols:["frcExpr2","_",{literal:"*"},"_","frcExpr3"],postprocess:s=>s[0].mul(s[4])},{name:"frcExpr2",symbols:["frcExpr2","_",{literal:"/"},"_","frcExpr3"],postprocess:s=>s[0].div(s[4])},{name:"frcExpr2",symbols:["frcExpr3"],postprocess:s},{name:"frcExpr3",symbols:[{literal:"-"},"_","frcExpr4"],postprocess:s=>s[2].neg()},{name:"frcExpr3",symbols:["frcExpr4"],postprocess:s},{name:"frcExpr4",symbols:["frcExpr5","_",{literal:"^"},"_","intExpr3"],postprocess:s=>s[0].pow(s[4])},{name:"frcExpr4",symbols:["frcExpr5"],postprocess:s},{name:"frcExpr5",symbols:["nonNegInt"],postprocess:s=>e(s[0])},{name:"frcExpr5",symbols:[{literal:"("},"_","frcExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"intExpr1",symbols:["intExpr1","_",{literal:"+"},"_","intExpr2"],postprocess:s=>s[0]+s[4]},{name:"intExpr1",symbols:["intExpr1","_",{literal:"-"},"_","intExpr2"],postprocess:s=>s[0]-s[4]},{name:"intExpr1",symbols:["intExpr2"],postprocess:s},{name:"intExpr2",symbols:["intExpr2","_",{literal:"*"},"_","intExpr3"],postprocess:s=>s[0]*s[4]},{name:"intExpr2",symbols:["intExpr3"],postprocess:s},{name:"intExpr3",symbols:[{literal:"-"},"_","intExpr4"],postprocess:s=>-s[2]},{name:"intExpr3",symbols:["intExpr4"],postprocess:s},{name:"intExpr4",symbols:["intExpr5","_",{literal:"^"},"_","posInt"],postprocess:s=>Math.pow(s[0],s[4])},{name:"intExpr4",symbols:["intExpr5"],postprocess:s},{name:"intExpr5",symbols:["nonNegInt"],postprocess:s=>parseInt(s[0])},{name:"intExpr5",symbols:[{literal:"("},"_","intExpr1","_",{literal:")"}],postprocess:s=>s[2]},{name:"posInt$ebnf$1",symbols:[]},{name:"posInt$ebnf$1",symbols:["posInt$ebnf$1",/[0-9]/],postprocess:function(s){return s[0].concat([s[1]])}},{name:"posInt",symbols:[/[1-9]/,"posInt$ebnf$1"],postprocess:s=>s[0]+s[1].join("")},{name:"nonNegInt",symbols:[{literal:"0"}],postprocess:s=>"0"},{name:"nonNegInt",symbols:["posInt"],postprocess:s},{name:"int$ebnf$1",symbols:[{literal:"-"}],postprocess:s},{name:"int$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"int",symbols:["int$ebnf$1","nonNegInt"],postprocess:s=>(s[0]||"")+s[1]},{name:"decimal$ebnf$1",symbols:[{literal:"-"}],postprocess:s},{name:"decimal$ebnf$1",symbols:[],postprocess:function(s){return null}},{name:"decimal$ebnf$2",symbols:[/[0-9]/]},{name:"decimal$ebnf$2",symbols:["decimal$ebnf$2",/[0-9]/],postprocess:function(s){return s[0].concat([s[1]])}},{name:"decimal$ebnf$3$subexpression$1$ebnf$1",symbols:[]},{name:"decimal$ebnf$3$subexpression$1$ebnf$1",symbols:["decimal$ebnf$3$subexpression$1$ebnf$1",/[0-9]/],postprocess:function(s){return s[0].concat([s[1]])}},{name:"decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1$ebnf$1",symbols:[/[0-9]/]},{name:"decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1$ebnf$1",symbols:["decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1$ebnf$1",/[0-9]/],postprocess:function(s){return s[0].concat([s[1]])}},{name:"decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1",symbols:[{literal:"("},"decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1$ebnf$1",{literal:")"}]},{name:"decimal$ebnf$3$subexpression$1$ebnf$2",symbols:["decimal$ebnf$3$subexpression$1$ebnf$2$subexpression$1"],postprocess:s},{name:"decimal$ebnf$3$subexpression$1$ebnf$2",symbols:[],postprocess:function(s){return null}},{name:"decimal$ebnf$3$subexpression$1",symbols:[{literal:"."},"decimal$ebnf$3$subexpression$1$ebnf$1","decimal$ebnf$3$subexpression$1$ebnf$2"]},{name:"decimal$ebnf$3",symbols:["decimal$ebnf$3$subexpression$1"],postprocess:s},{name:"decimal$ebnf$3",symbols:[],postprocess:function(s){return null}},{name:"decimal",symbols:["decimal$ebnf$1","decimal$ebnf$2","decimal$ebnf$3"],postprocess:s=>(s[0]||"")+s[1].join("")+(s[2]?"."+s[2][1].join("")+(s[2][2]?"("+s[2][2][1].join("")+")":""):"")},{name:"hertz$string$1",symbols:[{literal:"h"},{literal:"z"}],postprocess:function(s){return s.join("")}},{name:"hertz",symbols:["hertz$string$1"]},{name:"hertz$string$2",symbols:[{literal:"H"},{literal:"z"}],postprocess:function(s){return s.join("")}},{name:"hertz",symbols:["hertz$string$2"]}],ParserStart:"top1"};"undefined"!=typeof module&&void 0!==module.exports?module.exports=$:window.grammar=$}();

},{"../edo.js":2,"../fjs.js":4,"../interval.js":6,"../pythagorean.js":11,"./eval.js":8,"./grammar-helpers.js":9,"fraction.js":12}],11:[function(require,module,exports){
const pf=require("primes-and-factors"),ntw=require("number-to-words"),Fraction=require("fraction.js"),Interval=require("./interval.js");function mod(e,t){return(e%t+t)%t}function pyInterval(e,t,n){const r=Fraction(t,n).mul(4*Math.sign(e));if(1!=r.d)throw"offset does not have denominator 1, 2, or 4";const o=e-Math.sign(e),a=2*(mod(4*o+3,7)-3)+r.s*r.n*7;return Interval({2:Fraction(a,4).sub((o-a)/7).neg(),3:Fraction(a,4)})}function isPythagorean(e,t){const n=new Interval(e,t),r=n[2]||Fraction(0),o=n[3]||Fraction(0);return Object.entries(n).length==!!n[2]+!!n[3]&&1==o.mul(4).d&&1==r.add(o).d}function pyGenerator(e,t){const n=(new Interval(e,t)[3]||Fraction(0)).mul(4);if(1!=n.d)throw"interval is not pythagorean";return n.s*n.n}function pyOctaves(e,t){const n=new Interval(e,t),r=n[2]||Fraction(0),o=n[3]||Fraction(0),a=r.add(o);if(1!=a.d)throw"interval is not pythagorean";return a.s*a.n}function pyDegree(e,t){const n=new Interval(e,t),r=pyGenerator(n)+7*pyOctaves(n);return 0==r?1:r+Math.sign(r)}function pyOffset(e,t){const n=new Interval(e,t),r=pyGenerator(n),o=r+7*pyOctaves(n),a=0==o?1:Math.sign(o);return Fraction(a*(2*Math.floor((4*r+3)/7)-r),4)}function pyRedDeg(e){return mod(e-Math.sign(e),7)+1}function isPerfectDeg(e){return 1==pyRedDeg(e)||4==pyRedDeg(e)||5==pyRedDeg(e)}function case2(e,t,n){return 0!=e&&e?n:t}function case3(e,t,n,r){return 0!=e&&e?1==e?n:r:t}function pyQuality(e,t,n){n||"object"!=typeof t||null==t||(n=t,t=void 0);const{verbosity:r}=n||{};let o=pyOffset(e,t);if(isPerfectDeg(pyDegree(e,t))){if(0==o)return case2(r,"P","perfect")}else{if(0==o)return case2(r,"n","neutral");if(.25==o)return case2(r,"sM","semi-major");if(.5==o)return case2(r,"M","major");if(-.25==o)return case2(r,"sm","semi-minor");if(-.5==o)return case2(r,"m","minor");o=o.sub(o.s,2)}return.5==o?case3(r,"sA","semi-aug","semi-augmented"):1==o?case3(r,"A","aug","augmented"):-.5==o?case3(r,"sd","semi-dim","semi-diminished"):-1==o?case3(r,"d","dim","diminished"):2==o&&2==r?"doubly augmented":-2==o&&2==r?"doubly diminished":o>0&&1==o.d?o.n+case3(r,"A","-aug","-augmented"):o>0&&1!=o.d?o.toFraction()+case3(r,"-A","-aug","-augmented"):o<0&&1==o.d?o.n+case3(r,"d","-dim","-diminished"):o<0&&1!=o.d?o.neg().toFraction()+case3(r,"-d","-dim","-diminished"):void 0}function pyDegreeString(e,t){return 0!=t&&t?1==t?ntw.toOrdinal(Math.abs(e)):1==Math.abs(e)?"unison":8==Math.abs(e)?"octave":ntw.toWordsOrdinal(Math.abs(e)):e}function pySymb(e,t,n){n||"object"!=typeof t||null==t||(n=t,t=void 0);const{verbosity:r}=n||{},o=pyDegree(e,t),a=case2(r,""," ")+pyDegreeString(o,r),i=r&&o<0?" down":"";return pyQuality(e,t,n)+a+i}function baseNoteIntvToA(e){return"C"==e?pyInterval(-6,.5):"D"==e?pyInterval(-5,0):"E"==e?pyInterval(-4,0):"F"==e?pyInterval(-3,.5):"G"==e?pyInterval(-2,.5):"A"==e?Interval(1):"B"==e?pyInterval(2,.5):void 0}function octaveOfIntvToA4(e,t){const n=Interval(e,t).div(baseNoteIntvToA("C"));return 4+Math.floor(Math.log(n.valueOf())/Math.log(2))}function pyNote(e,t){const n=Interval(e).div(baseNoteIntvToA("F"));if(!isPythagorean(n)||n[3]&&1!=n[3].d)throw"interval is not a non-neutral pythagorean interval";const r=n[3]?n[3].s*n[3].n:Fraction(0),o=mod(4*r,7);let a,i=Math.floor(r/7),s=octaveOfIntvToA4(e);4==s&&(s=""),0==o&&(a="F"),1==o&&(a="G"),2==o&&(a="A"),3==o&&(a="B"),4==o&&(a="C"),5==o&&(a="D"),6==o&&(a="E");let u="";for(0==i&&"A"==a&&""!=s&&(u+="♮");i>1;)u+=t?"X":"𝄪",i-=2;for(1==i&&(u+=t?"#":"♯");i<-1;)t?(u+="b",i+=1):(u+="𝄫",i+=2);return-1==i&&(u+=t?"b":"♭"),a+u+s}module.exports.pyInterval=pyInterval,module.exports.isPythagorean=isPythagorean,module.exports.pyGenerator=pyGenerator,module.exports.pyOctaves=pyOctaves,module.exports.pyDegree=pyDegree,module.exports.pyOffset=pyOffset,module.exports.pyRedDeg=pyRedDeg,module.exports.isPerfectDeg=isPerfectDeg,module.exports.pyQuality=pyQuality,module.exports.pySymb=pySymb,module.exports.pySymb=pySymb,module.exports.baseNoteIntvToA=baseNoteIntvToA,module.exports.octaveOfIntvToA4=octaveOfIntvToA4,module.exports.pyNote=pyNote;

},{"./interval.js":6,"fraction.js":12,"number-to-words":15,"primes-and-factors":16}],12:[function(require,module,exports){
!function(t){"use strict";var n=2e3,i={s:1,n:0,d:1};function s(t){function n(){var n=Error.apply(this,arguments);n.name=this.name=t,this.stack=n.stack,this.message=n.message}function i(){}return i.prototype=Error.prototype,n.prototype=new i,n}var r=f.DivisionByZero=s("DivisionByZero"),e=f.InvalidParameter=s("InvalidParameter");function h(t,n){return isNaN(t=parseInt(t,10))&&o(),t*n}function o(){throw new e}var a=function(t,n){var s,e=0,a=1,u=1,f=0,d=0,c=0,N=1,l=1,w=0,p=1,v=1,M=1,b=1e7;if(null==t);else if(void 0!==n)u=(e=t)*(a=n);else switch(typeof t){case"object":"d"in t&&"n"in t?(e=t.n,a=t.d,"s"in t&&(e*=t.s)):0 in t?(e=t[0],1 in t&&(a=t[1])):o(),u=e*a;break;case"number":if(t<0&&(u=t,t=-t),t%1==0)e=t;else if(t>0){for(t>=1&&(t/=l=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));p<=b&&M<=b;){if(t===(s=(w+v)/(p+M))){p+M<=b?(e=w+v,a=p+M):M>p?(e=v,a=M):(e=w,a=p);break}t>s?(w+=v,p+=M):(v+=w,M+=p),p>b?(e=v,a=M):(e=w,a=p)}e*=l}else(isNaN(t)||isNaN(n))&&(a=e=NaN);break;case"string":if(null===(p=t.match(/\d+|./g))&&o(),"-"===p[w]?(u=-1,w++):"+"===p[w]&&w++,p.length===w+1?d=h(p[w++],u):"."===p[w+1]||"."===p[w]?("."!==p[w]&&(f=h(p[w++],u)),(++w+1===p.length||"("===p[w+1]&&")"===p[w+3]||"'"===p[w+1]&&"'"===p[w+3])&&(d=h(p[w],u),N=Math.pow(10,p[w].length),w++),("("===p[w]&&")"===p[w+2]||"'"===p[w]&&"'"===p[w+2])&&(c=h(p[w+1],u),l=Math.pow(10,p[w+1].length)-1,w+=3)):"/"===p[w+1]||":"===p[w+1]?(d=h(p[w],u),N=h(p[w+2],1),w+=3):"/"===p[w+3]&&" "===p[w+1]&&(f=h(p[w],u),d=h(p[w+2],u),N=h(p[w+4],1),w+=5),p.length<=w){u=e=c+(a=N*l)*f+l*d;break}default:o()}if(0===a)throw new r;i.s=u<0?-1:1,i.n=Math.abs(e),i.d=Math.abs(a)};function u(t,n){if(!t)return n;if(!n)return t;for(;;){if(!(t%=n))return n;if(!(n%=t))return t}}function f(t,n){if(!(this instanceof f))return new f(t,n);a(t,n),t=f.REDUCE?u(i.d,i.n):1,this.s=i.s,this.n=i.n/t,this.d=i.d/t}f.REDUCE=1,f.prototype={s:1,n:0,d:1,abs:function(){return new f(this.n,this.d)},neg:function(){return new f(-this.s*this.n,this.d)},add:function(t,n){return a(t,n),new f(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(t,n){return a(t,n),new f(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(t,n){return a(t,n),new f(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(t,n){return a(t,n),new f(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return new f(this)},mod:function(t,n){return isNaN(this.n)||isNaN(this.d)?new f(NaN):void 0===t?new f(this.s*this.n%this.d,1):(a(t,n),0===i.n&&0===this.d&&f(0,0),new f(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d))},gcd:function(t,n){return a(t,n),new f(u(i.n,this.n)*u(i.d,this.d),i.d*this.d)},lcm:function(t,n){return a(t,n),0===i.n&&0===this.n?new f:new f(i.n*this.n,u(i.n,this.n)*u(i.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new f(NaN):new f(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new f(NaN):new f(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new f(NaN):new f(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new f(this.s*this.d,this.n)},pow:function(t){return t<0?new f(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new f(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,n){return a(t,n),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(t,n){a(t,n);var s=this.s*this.n*i.d-i.s*i.n*this.d;return(0<s)-(s<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var n=this.abs().toContinued();function i(t){return 1===t.length?new f(t[0]):i(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var s=0;s<n.length;s++){var r=i(n.slice(0,s+1));if(r.sub(this.abs()).abs().valueOf()<t)return r.mul(this.s)}return this},divisible:function(t,n){return a(t,n),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var n,i="",s=this.n,r=this.d;return this.s<0&&(i+="-"),1===r?i+=s:(t&&(n=Math.floor(s/r))>0&&(i+=n,i+=" ",s%=r),i+=s,i+="/",i+=r),i},toLatex:function(t){var n,i="",s=this.n,r=this.d;return this.s<0&&(i+="-"),1===r?i+=s:(t&&(n=Math.floor(s/r))>0&&(i+=n,s%=r),i+="\\frac{",i+=s,i+="}{",i+=r,i+="}"),i},toContinued:function(){var t,n=this.n,i=this.d,s=[];if(isNaN(n)||isNaN(i))return s;do{s.push(Math.floor(n/i)),t=n%i,n=i,i=t}while(1!==n);return s},toString:function(t){var i,s=this.n,r=this.d;if(isNaN(s)||isNaN(r))return"NaN";f.REDUCE||(s/=i=u(s,r),r/=i),t=t||15;var e=function(t,i){for(;i%2==0;i/=2);for(;i%5==0;i/=5);if(1===i)return 0;for(var s=10%i,r=1;1!==s;r++)if(s=10*s%i,r>n)return 0;return r}(0,r),h=function(t,n,i){for(var s=1,r=function(t,n,i){for(var s=1;n>0;t=t*t%i,n>>=1)1&n&&(s=s*t%i);return s}(10,i,n),e=0;e<300;e++){if(s===r)return e;s=10*s%n,r=10*r%n}return 0}(0,r,e),o=-1===this.s?"-":"";if(o+=s/r|0,s%=r,(s*=10)&&(o+="."),e){for(var a=h;a--;)o+=s/r|0,s%=r,s*=10;o+="(";for(a=e;a--;)o+=s/r|0,s%=r,s*=10;o+=")"}else for(a=t;s&&a--;)o+=s/r|0,s%=r,s*=10;return o}},"function"==typeof define&&define.amd?define([],function(){return f}):"object"==typeof exports?(Object.defineProperty(f,"__esModule",{value:!0}),f.default=f,f.Fraction=f,module.exports=f):t.Fraction=f}(this);

},{}],13:[function(require,module,exports){
var MathUtils=module.exports={isOdd:function(t){return!0&t},isEven:function(t){return!1&t},powermod:function t(r,n,i){return 1===n?r%i:MathUtils.isOdd(n)?r*t(r,n-1,i)%i:Math.pow(t(r,n/2,i),2)%i},isPrime:function(t){return MathUtils.fastIsPrime(t)&&MathUtils.slowIsPrime(t)},slowIsPrime:function(t){if(MathUtils.isEven(t))return!1;for(var r=3,n=Math.sqrt(t);r<n;r+=2)if(t%r==0)return!1;return!0},fastIsPrime:function(t){return 1===MathUtils.powermod(3,t-1,t)},randomPrime:function(t){var r=Math.floor(Math.pow(10,t||3)*Math.random());for(MathUtils.isEven(r)&&r++;!MathUtils.isPrime(r);)r+=2;return r},gcd:function t(r,n){return 0===n?r:t(n,r%n)},egcd:function t(r,n){if(0===n)return[r,1,0];var i=t(n,r%n),e=i[1],o=i[2];return[i[0],o,e-Math.floor(r/n)*o]},modularInverse:function(t,r){return MathUtils.egcd(t,r)[1]}};

},{}],14:[function(require,module,exports){
!function(t,e){"object"==typeof module&&module.exports?module.exports=e():t.nearley=e()}(this,function(){function t(e,r,i){return this.id=++t.highestId,this.name=e,this.symbols=r,this.postprocess=i,this}function e(t,e,r,i){this.rule=t,this.dot=e,this.reference=r,this.data=[],this.wantedBy=i,this.isComplete=this.dot===t.symbols.length}function r(t,e){this.grammar=t,this.index=e,this.states=[],this.wants={},this.scannable=[],this.completed={}}function i(t,e){this.rules=t,this.start=e||this.rules[0].name;var r=this.byName={};this.rules.forEach(function(t){r.hasOwnProperty(t.name)||(r[t.name]=[]),r[t.name].push(t)})}function n(){this.reset("")}function s(t,e,s){if(t instanceof i){var o=t;s=e}else o=i.fromCompiled(t,e);for(var a in this.grammar=o,this.options={keepHistory:!1,lexer:o.lexer||new n},s||{})this.options[a]=s[a];this.lexer=this.options.lexer,this.lexerState=void 0;var h=new r(o,0);this.table=[h];h.wants[o.start]=[],h.predict(o.start),h.process(),this.current=0}function o(t){var e=typeof t;if("string"===e)return t;if("object"===e){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return t.toString();if(t.type)return"%"+t.type;if(t.test)return"<"+String(t.test)+">";throw new Error("Unknown symbol type: "+t)}}return t.highestId=0,t.prototype.toString=function(t){var e=void 0===t?this.symbols.map(o).join(" "):this.symbols.slice(0,t).map(o).join(" ")+" ● "+this.symbols.slice(t).map(o).join(" ");return this.name+" → "+e},e.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(t){var r=new e(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=t,r.isComplete&&(r.data=r.build(),r.right=void 0),r},e.prototype.build=function(){var t=[],e=this;do{t.push(e.right.data),e=e.left}while(e.left);return t.reverse(),t},e.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,s.fail))},r.prototype.process=function(t){for(var e=this.states,r=this.wants,i=this.completed,n=0;n<e.length;n++){var o=e[n];if(o.isComplete){if(o.finish(),o.data!==s.fail){for(var a=o.wantedBy,h=a.length;h--;){var l=a[h];this.complete(l,o)}if(o.reference===this.index){var p=o.rule.name;(this.completed[p]=this.completed[p]||[]).push(o)}}}else{if("string"!=typeof(p=o.rule.symbols[o.dot])){this.scannable.push(o);continue}if(r[p]){if(r[p].push(o),i.hasOwnProperty(p)){var u=i[p];for(h=0;h<u.length;h++){var f=u[h];this.complete(o,f)}}}else r[p]=[o],this.predict(p)}}},r.prototype.predict=function(t){for(var r=this.grammar.byName[t]||[],i=0;i<r.length;i++){var n=r[i],s=this.wants[t],o=new e(n,0,this.index,s);this.states.push(o)}},r.prototype.complete=function(t,e){var r=t.nextState(e);this.states.push(r)},i.fromCompiled=function(e,r){var n=e.Lexer;e.ParserStart&&(r=e.ParserStart,e=e.ParserRules);var s=new i(e=e.map(function(e){return new t(e.name,e.symbols,e.postprocess)}),r);return s.lexer=n,s},n.prototype.reset=function(t,e){this.buffer=t,this.index=0,this.line=e?e.line:1,this.lastLineBreak=e?-e.col:0},n.prototype.next=function(){if(this.index<this.buffer.length){var t=this.buffer[this.index++];return"\n"===t&&(this.line+=1,this.lastLineBreak=this.index),{value:t}}},n.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},n.prototype.formatError=function(t,e){var r=this.buffer;if("string"==typeof r){var i=r.split("\n").slice(Math.max(0,this.line-5),this.line),n=r.indexOf("\n",this.index);-1===n&&(n=r.length);var s=this.index-this.lastLineBreak,o=String(this.line).length;return e+=" at line "+this.line+" col "+s+":\n\n",e+=i.map(function(t,e){return a(this.line-i.length+e+1,o)+" "+t},this).join("\n"),e+="\n"+a("",o+s)+"^\n"}return e+" at index "+(this.index-1);function a(t,e){var r=String(t);return Array(e-r.length+1).join(" ")+r}},s.fail={},s.prototype.feed=function(t){var e,i=this.lexer;for(i.reset(t,this.lexerState);;){try{if(!(e=i.next()))break}catch(t){var s=new r(this.grammar,this.current+1);throw this.table.push(s),(h=new Error(this.reportLexerError(t))).offset=this.current,h.token=t.token,h}var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var a=this.current+1;s=new r(this.grammar,a);this.table.push(s);for(var h,l=void 0!==e.text?e.text:e.value,p=i.constructor===n?e.value:e,u=o.scannable,f=u.length;f--;){var c=u[f],y=c.rule.symbols[c.dot];if(y.test?y.test(p):y.type?y.type===e.type:y.literal===l){var m=c.nextState({data:p,token:e,isToken:!0,reference:a-1});s.states.push(m)}}if(s.process(),0===s.states.length)throw(h=new Error(this.reportError(e))).offset=this.current,h.token=e,h;this.options.keepHistory&&(o.lexerState=i.save()),this.current++}return o&&(this.lexerState=i.save()),this.results=this.finish(),this},s.prototype.reportLexerError=function(t){var e,r,i=t.token;return i?(e="input "+JSON.stringify(i.text[0])+" (lexer error)",r=this.lexer.formatError(i,"Syntax error")):(e="input (lexer error)",r=t.message),this.reportErrorCommon(r,e)},s.prototype.reportError=function(t){var e=(t.type?t.type+" token: ":"")+JSON.stringify(void 0!==t.value?t.value:t),r=this.lexer.formatError(t,"Syntax error");return this.reportErrorCommon(r,e)},s.prototype.reportErrorCommon=function(t,e){var r=[];r.push(t);var i=this.table.length-2,n=this.table[i],s=n.states.filter(function(t){var e=t.rule.symbols[t.dot];return e&&"string"!=typeof e});0===s.length?(r.push("Unexpected "+e+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(n.states,r)):(r.push("Unexpected "+e+". Instead, I was expecting to see one of the following:\n"),s.map(function(t){return this.buildFirstStateStack(t,[])||[t]},this).forEach(function(t){var e=t[0],i=e.rule.symbols[e.dot],n=this.getSymbolDisplay(i);r.push("A "+n+" based on:"),this.displayStateStack(t,r)},this));return r.push(""),r.join("\n")},s.prototype.displayStateStack=function(t,e){for(var r,i=0,n=0;n<t.length;n++){var s=t[n],o=s.rule.toString(s.dot);o===r?i++:(i>0&&e.push("    ^ "+i+" more lines identical to this"),i=0,e.push("    "+o)),r=o}},s.prototype.getSymbolDisplay=function(t){return function(t){var e=typeof t;if("string"===e)return t;if("object"===e){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return"character matching "+t;if(t.type)return t.type+" token";if(t.test)return"token matching "+String(t.test);throw new Error("Unknown symbol type: "+t)}}(t)},s.prototype.buildFirstStateStack=function(t,e){if(-1!==e.indexOf(t))return null;if(0===t.wantedBy.length)return[t];var r=t.wantedBy[0],i=[t].concat(e),n=this.buildFirstStateStack(r,i);return null===n?null:[t].concat(n)},s.prototype.save=function(){var t=this.table[this.current];return t.lexerState=this.lexerState,t},s.prototype.restore=function(t){var e=t.index;this.current=e,this.table[e]=t,this.table.splice(e+1),this.lexerState=t.lexerState,this.results=this.finish()},s.prototype.rewind=function(t){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[t])},s.prototype.finish=function(){var t=[],e=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(r){r.rule.name===e&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==s.fail&&t.push(r)}),t.map(function(t){return t.data})},{Parser:s,Grammar:i,Rule:t}});

},{}],15:[function(require,module,exports){
(function (global){(function (){
!function(){"use strict";var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,t=9007199254740991;function n(e){return!("number"!=typeof e||e!=e||e===1/0||e===-1/0)}function r(e){return"number"==typeof e&&Math.abs(e)<=t}var o=/(hundred|thousand|(m|b|tr|quadr)illion)$/,i=/teen$/,f=/y$/,l=/(zero|one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve)$/,s={zero:"zeroth",one:"first",two:"second",three:"third",four:"fourth",five:"fifth",six:"sixth",seven:"seventh",eight:"eighth",nine:"ninth",ten:"tenth",eleven:"eleventh",twelve:"twelfth"};function h(e){return o.test(e)||i.test(e)?e+"th":f.test(e)?e.replace(f,"ieth"):l.test(e)?e.replace(l,a):e}function a(e,t){return s[t]}var u=10,d=100,p=1e3,v=1e6,b=1e9,y=1e12,c=1e15,g=9007199254740992,m=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],w=["zero","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function x(e,t){var o,i=parseInt(e,10);if(!n(i))throw new TypeError("Not a finite number: "+e+" ("+typeof e+")");if(!r(i))throw new RangeError("Input is not a safe number, it’s either too large or too small.");return o=function e(t){var n,r,o=arguments[1];return 0===t?o?o.join(" ").replace(/,$/,""):"zero":(o||(o=[]),t<0&&(o.push("minus"),t=Math.abs(t)),t<20?(n=0,r=m[t]):t<d?(n=t%u,r=w[Math.floor(t/u)],n&&(r+="-"+m[n],n=0)):t<p?(n=t%d,r=e(Math.floor(t/d))+" hundred"):t<v?(n=t%p,r=e(Math.floor(t/p))+" thousand,"):t<b?(n=t%v,r=e(Math.floor(t/v))+" million,"):t<y?(n=t%b,r=e(Math.floor(t/b))+" billion,"):t<c?(n=t%y,r=e(Math.floor(t/y))+" trillion,"):t<=g&&(n=t%c,r=e(Math.floor(t/c))+" quadrillion,"),o.push(r),e(n,o))}(i),t?h(o):o}var M={toOrdinal:function(e){var t=parseInt(e,10);if(!n(t))throw new TypeError("Not a finite number: "+e+" ("+typeof e+")");if(!r(t))throw new RangeError("Input is not a safe number, it’s either too large or too small.");var o=String(t),i=Math.abs(t%100),f=11<=i&&i<=13,l=o.charAt(o.length-1);return o+(f?"th":"1"===l?"st":"2"===l?"nd":"3"===l?"rd":"th")},toWords:x,toWordsOrdinal:function(e){return h(x(e))}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=M),exports.numberToWords=M):e.numberToWords=M}();

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],16:[function(require,module,exports){
"use strict";var primeFactor={isPrime:function(r){if(!Number.isInteger(r)||r<2)return!1;if(r%2==0)return 2===r;if(r%3==0)return 3===r;for(var t=Math.floor(Math.sqrt(r)),e=5;e<=t;e+=6)if(r%e==0||r%(e+2)==0)return!1;return!0},calculate:function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!Number.isInteger(r))return t;var n=Math.abs(r);if(n<2)return t;var i=Math.sqrt(n),a=2;if(n%a&&n%(a=3)){a=5;for(var u=2;n%a&&a<i;)a+=u,u=6-u}(a=a<=i?a:n,e)?t.push(a):t.indexOf(a)<0&&t.push(a);return a===n?t:this.calculate(n/a,t,e)},getFactors:function(r){return this.calculate(r,[],!0)},getUniqueFactors:function(r){return this.calculate(r,[],!1)},getPrimeExponentObject:function(r){var t=this.calculate(r),e={},n=!0,i=!1,a=void 0;try{for(var u,o=t[Symbol.iterator]();!(n=(u=o.next()).done);n=!0){var c=u.value;Number.isFinite(e[c])?e[c]+=1:e[c]=1}}catch(r){i=!0,a=r}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return e},getFrequency:function(r){var t=this.getPrimeExponentObject(r),e=[];for(var n in t)if({}.hasOwnProperty.call(t,n)){var i={factor:Number(n),times:t[n]};e.push(i)}return e}};module.exports=primeFactor;

},{}]},{},[5])(5)
});
//# sourceMappingURL=microtonal-utils.min.js.map
